@model Servicify.Models.CreateServiceViewModel

@{
    ViewBag.Title = "Create Service";
    Layout = "_Layout";
}

<link rel="stylesheet" href="~/css/login-style.css">
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<div class="main__content flex justify-between items-center pt-16">
    <div class="login__form">
    <h1 class="form__content-title">Создание услуги</h1>
            <form class="form__content" method="post" action="/services/create" id="createServiceForm">
                <div class="form-group">
                    <label asp-for="Name">Наименование:</label>
                    <input asp-for="Name" class="form-control" id="Name"/>
                </div>
        
                <div class="form-group">
                    <label asp-for="Description">Описание:</label>
                    <textarea asp-for="Description" class="form-control" id="Description"></textarea>
                </div>
        
                <div class="form-group">
                    <label asp-for="Description">Продолжительность:</label>
                    <textarea asp-for="Description" class="form-control" id="Description"></textarea>
                </div>
                
                <div class="form-group">
                    <label asp-for="Cost">Стоимость:</label>
                    <input asp-for="Cost" class="form-control" id="Cost"/>
                </div>
        
                <div class="form-group" id="availableTimesContainer">
                    <label for="AvailableTimes">Доступное время:</label>
        
                    <div class="available-time">
                        <input asp-for="AvailableTimes" type="datetime-local" class="form-control"/>
                    </div>
        
                    <button type="button" id="addTimeButton">Добавить время</button>
                </div>
        
                <button type="submit" class="form__content-button login" onclick="submitForm()">Создать</button>
            </form>
    </div>

    @section Scripts {
        <script>
            $(document).ready(function () {
                $('#addTimeButton').on('click', function () {
                    var newTimeHtml = '<div class="available-time">' +
                        '<input asp-for="AvailableTimes" type="datetime-local" class="form-control" />' +
                        '</div>';

                    $('#availableTimesContainer').append(newTimeHtml);
                });

                $('#createServiceForm').submit(function (event) {
                    event.preventDefault();

                    $.ajax({
                        url: '/services/create',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            Name: $('#Name').val(),
                            Description: $('#Description').val(),
                            Cost: $('#Cost').val(),
                            AvailableTimes: $('.available-time input[type=datetime-local]')
                                .map(function () { return $(this).val(); }).get()
                        }),
                        success: function (data) {
                            window.location.href = '/';
                        },
                        error: function (xhr, status, error) {
                            // Обработка ошибки
                        }
                    });
                });
            });
        </script>
    }

</div>
